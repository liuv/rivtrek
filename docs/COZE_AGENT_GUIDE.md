# 河川引路人 - Coze 智能体创建指引

本文档指导您在 Coze.cn 平台创建「河川引路人」智能体，用于涉川 App 的江河风土介绍与诗词签名生成。

## 一、前置准备

1. 已注册 [Coze.cn](https://www.coze.cn) 账号
2. 已安装涉川 App 并完成基础配置

---

## 二、创建智能体

### 1. 进入 Coze 工作台

1. 登录 [Coze.cn](https://www.coze.cn)
2. 点击「创建智能体」或进入「我的智能体」→「创建」

### 2. 基础配置

| 配置项 | 建议值 |
|--------|--------|
| **名称** | 河川引路人 |
| **描述** | 江河向导，介绍河流风土人情、历史典故，并为涉川用户生成个性化诗词签名 |
| **头像** | 可选河流/山水风格图标 |

### 3. 人设与回复逻辑（核心）

在「人设与回复逻辑」→「人设」中填写以下内容（可根据需要微调）：

```
你是「河川引路人」，一位博学而富有诗意的江河向导，服务于涉川 App 的用户。

【核心能力】
1. 江河风土介绍：根据用户当前行走的河段（河流名、河段名、累计公里数），介绍该地的风土人情、历史典故、传说故事、人文景观。
2. 诗词签名生成：根据用户的昵称、挑战河流、当前河段、行走进度，创作一句 8–20 字的古风/诗词风格签名，适合作为分享卡底部结语。直接输出签名内容，不加引号或解释。

【交互风格】
- 语言简洁、有文采，可适当引用古诗文
- 介绍河段时结合地理、历史、文化，富有画面感
- 回复不宜过长，便于在手机端阅读

【上下文说明】
用户消息中可能包含「【当前行走位置】」开头的上下文，格式如下：
- 河流：xxx
- 总长：xxx 公里
- 当前累计行走：xxx 公里
- 当前河段：xxx

请根据上述信息，优先回答与当前河段相关的问题，使介绍更贴合用户的实际行走进度。
```

### 4. 开场白（可选）

建议设置一句开场白，例如：

```
你好，我是河川引路人。你正在挑战哪条江河？走到哪一段了？我可以为你介绍当地的风土人情，或为你生成一句诗词签名，用于分享。
```

### 5. 回复逻辑（可选）

- 若希望智能体更主动地结合上下文，可在「回复逻辑」中增加「根据用户信息调整回复」的规则
- 建议开启「多轮对话」以支持连续提问

---

## 三、发布与获取 API 密钥

### 1. 发布智能体

1. 在智能体编辑页右上角点击「发布」
2. 选择「API 访问」或「网页/移动端」等接入方式
3. 确认发布后，智能体进入「已发布」状态

### 2. 获取 Bot ID

1. 发布后，在智能体详情页找到「Bot ID」或「智能体 ID」
2. 也可从浏览器地址栏获取：URL 形如 `https://www.coze.cn/space/xxx/bot/7504921655593***`，其中 `7504921655593***` 即为 Bot ID
3. 复制该 ID，保存备用

### 3. 获取 API Token（重要：必须用 PAT）

1. 打开 [Coze 开放平台](https://www.coze.cn/open) → 登录后点击左下角头像 → **「API 授权」**
2. 在「个人访问令牌 (PAT)」页面点击「新建」或「添加」
3. 设置名称、过期时间，勾选所需权限（至少包含对话相关权限）
4. 生成后**立即复制** Token（格式通常为 `pat_xxx`），仅展示一次
5. **注意**：若出现 401 认证失败，请确认使用的是上述 PAT，而非智能体测试页或其它渠道的临时 token

---

## 四、在涉川 App 中配置

### 方式 A：构建时注入（推荐，用户无需填写）

开发者在打正式包时，将凭证通过 `--dart-define` 注入，用户安装后即可使用，无需在设置中填写。

**步骤：**

1. 复制 `dart_defines.json.example` 为 `dart_defines.json`（该文件已加入 .gitignore，不会提交）
2. 在 `dart_defines.json` 中填入真实凭证：
   ```json
   {
     "COZE_API_TOKEN": "cztei_hL1Ef0n6nUqlYXivfIGSfWDDybjrd8GQjxGHGPuzjcMWULGqp5xHnBPXCjjhWT5nX",
     "COZE_BOT_ID": "7610775641889947698"
   }
   ```
3. 构建时使用：
   ```bash
   fvm flutter build apk --release --dart-define-from-file=dart_defines.json
   ```
   或直接传参：
   ```bash
   fvm flutter build apk --release \
     --dart-define=COZE_API_TOKEN=你的Token \
     --dart-define=COZE_BOT_ID=你的BotID
   ```

**安全说明：**

- `dart_defines.json` 已加入 .gitignore，切勿提交到版本库
- 凭证会编译进二进制，建议：定期轮换 Token、在 Coze 控制台设置用量限制
- 若需更高安全性，可考虑自建后端代理 Coze API

### 方式 B：应用内配置（开发调试用）

1. 打开涉川 App → **行者** → **应用设置**
2. 找到「河川引路人（Coze）」部分
3. 填写 API Token 和 Bot ID，点击「保存」

配置完成后，可在「河川引路人」入口与智能体对话，或在「分享进度」中选择「AI 生成诗词签名」。

---

## 五、测试建议

### 在 Coze 平台测试

1. 在智能体编辑页使用「对话预览」功能
2. 模拟用户输入，例如：
   - 「【当前行走位置】河流：长江\n总长：6387 公里\n当前累计行走：1500 公里\n当前河段：金沙江中游·虎跳峡核心段\n\n介绍一下我现在所在的河段有什么特色？」
   - 「为我生成一句诗词签名，用于分享」

### 在 App 中测试

1. 配置完成后，进入「河川引路人」页面
2. 点击建议问题或输入自定义问题
3. 在「分享进度」→「落款结语」→「AI 生成诗词签名」中测试诗词生成

---

## 六、常见问题

### Q：Bot ID 在哪里找？

A：在 Coze 智能体详情页的 URL 中，或「发布」→「API 接入」相关配置中。格式为纯数字长串。

### Q：Token 无效或过期？

A：请到 Coze 开放平台重新生成 Token，并在 App 设置中更新。

### Q：智能体回复与河段无关？

A：检查人设中是否包含对「【当前行走位置】」上下文的说明；App 会在用户消息前自动附带该信息。

### Q：诗词签名太长或风格不符？

A：在人设中进一步强调「8–20 字」「古风/诗词风格」「直接输出签名内容」等要求。

---

## 七、参考资源

- [Coze 开放平台文档](https://www.coze.cn/api/open/docs)
- [Coze 智能体创建指南](https://www.coze.cn/docs)
