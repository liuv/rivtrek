# 河畔实景混音方案 · Ambient Mix Design

基于现有素材（河水 murmur、蛙鸣 frog、雨声 rain、风声 wind、雷声 rumble），结合**天气**、**昼夜**、**场景**设计一套科学仿真的混音方案，用于放河灯/漂流瓶仪式与沉浸听水/正念冥想入口。

---

## 一、音层定义与声学角色

| 层 | 素材 | 声学角色 | 使用原则 |
|----|------|----------|----------|
| **murmur** | murmur_01.ogg | 基底层 · 河流连续声 | 始终存在，音量作为整体基准（0.28–0.42），其它层相对其平衡。 |
| **rain** | rain.ogg | 降水层 | 仅在有降水类天气时加入（毛毛雨/雨/阵雨/雷雨），强度随降水等级变化。 |
| **wind** | wind.ogg | 大气层 | 晴朗/多云/阴/雾时表现「户外感」；风雨时增强体感；雷暴时与雨、雷配合。 |
| **frog** | frog.ogg | 生物层 · 夜与季节 | 夜间、晴/多云时更易出现；春夏权重高于秋冬（按月份弱化）。 |
| **rumble** | rumble.ogg | 事件层 · 雷暴 | 仅雷暴/雷暴冰雹时使用，低频铺底、偶发感，不抢人声与河水。 |

混音原则：**河水为锚，天气定景，昼夜调生物与风，场景定总响度与层次感。**

---

## 二、天气 → 音层矩阵（WMO / WeatherType）

以下体积为**相对基准**，最终再乘场景系数与总增益。数值范围 0.0–1.0，表示该层在「该天气下的目标相对电平」。

| WeatherType | murmur | rain | wind | frog | rumble | 说明 |
|-------------|--------|------|------|------|--------|------|
| clearSky | 1.0 | 0 | 0.35 | 见昼夜 | 0 | 晴：河为主，轻风，蛙鸣随昼夜/季节。 |
| mainlyClear | 1.0 | 0 | 0.38 | 见昼夜 | 0 | 大部晴：同上，风略增。 |
| partlyCloudy | 0.95 | 0 | 0.42 | 见昼夜 | 0 | 多云：风略增，河略让位。 |
| overcast | 0.92 | 0 | 0.45 | 0.15 | 0 | 阴：风更显，蛙鸣弱。 |
| fog | 0.88 | 0 | 0.28 | 0 | 0 | 雾：河+轻微风，压抑感。 |
| drizzle | 0.85 | 0.45 | 0.40 | 0 | 0 | 毛毛雨：雨层明显但柔。 |
| rainSlight | 0.82 | 0.55 | 0.45 | 0 | 0 | 小雨。 |
| rainModerate | 0.78 | 0.68 | 0.50 | 0 | 0 | 中雨。 |
| rainHeavy | 0.72 | 0.82 | 0.55 | 0 | 0 | 大雨：雨主导。 |
| rainShowers | 0.75 | 0.70 | 0.52 | 0 | 0 | 阵雨。 |
| thunderstorm | 0.70 | 0.75 | 0.50 | 0 | 0.45 | 雷暴：河+雨+风+低频雷。 |
| thunderstormHail | 0.68 | 0.78 | 0.52 | 0 | 0.55 | 雷暴冰雹：雷略强。 |
| snow* | 0.85 | 0 | 0.48 | 0 | 0 | 雪天：无雨层，风略大（雪落无声用风补）。 |
| unknown | 0.95 | 0 | 0.40 | 见昼夜 | 0 | 未知：保守混音。 |

*雪类（snowSlight / snowModerate / snowHeavy / snowGrains / snowShowers）统一按「无雨、风 0.48、无蛙无雷」处理。

---

## 三、昼夜与蛙鸣 / 风

- **昼夜判定**：`hour in [6, 18)` 为白天，否则为夜间（可配置黎明/黄昏过渡）。
- **蛙鸣 frog**：
  - 仅当天气为 clearSky / mainlyClear / partlyCloudy / unknown 时启用。
  - 白天：0.25；夜间：0.50（夜间更活跃）。
  - **季节**：月份 3–9（春–秋）系数 1.0；10–2 系数 0.4（冬季几乎不鸣）。
- **风 wind**：
  - 夜间在「无降水」天气下略降 0.92 倍，避免抢戏；降水/雷暴时不降。

---

## 四、场景（Context）与总增益

| 场景 | 说明 | 总增益 | murmur 相对 | 其它层 |
|------|------|--------|-------------|--------|
| **ritual** | 放河灯/漂流瓶仪式 | 0.88 | 略突出 | 辅助，不抢仪式感。 |
| **immersive** | 沉浸听水/正念冥想 | 1.0 | 平衡 | 完整混音，沉浸感与放松。 |

- ritual：各层在矩阵值基础上 × 0.88，murmur 再 × 1.08，使河声仍为绝对主体。
- immersive：直接采用矩阵+昼夜+季节结果，总输出可再限制峰值（如归一化或限幅）避免过响。

---

## 五、技术实现要点

1. **多轨播放**：每条层独立 `AudioPlayer`，各自 `setLoopMode(LoopMode.one)`，`setVolume(v)` 由当前 `AmbientMixSpec` 驱动。
2. **实现依据**：与 audio_service / just_audio 官方范例的对应关系、stop/dispose 与加载中断约定见 **docs/AMBIENT_AUDIO_REFERENCES.md**，修改前请先阅该文档。
3. **淡入淡出**：进入时各层按目标音量淡入（建议 1.2–1.8s）；离开时统一淡出（0.4–0.6s），避免突兀。
4. **雷声 rumble**：可循环但音量宜保守（0.35–0.55），或后续改为随机触发短片段以更真实。
5. **无天气时**：使用 `unknown` 或上次缓存的 `wmoCode`，避免静音或错乱。
6. **性能**：同时 5 轨对移动端可接受；若需省电，可仅加载当前配方中 volume > 0 的层。

---

## 六、与产品入口的对应

- **仪式页（放河灯/漂流瓶）**：使用 `context: ritual`，传入当前 `WeatherType` + 昼夜 + 季节，播放对应混音；离开时统一淡出。
- **沉浸听水/正念入口**：独立页面，使用 `context: immersive`，可展示当前天气与混音说明，支持长时间播放。

以上方案保证：**同一套配方与代码**，仅通过天气、时间、场景三个维度即可复现科学、一致的河畔实景听感，并兼顾仪式感与冥想场景。
